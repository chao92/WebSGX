<html>
<head>
</head>
<body>
    <form action="send_receive_MSG1.php" method="get">
        Ask SSL?: <input type="text" name="askSSL" placeholder="SSL! or nSSL">
        <button type="submit" name="submit">Submit!</button>
        
    </form>
    <button id="A_btn_gen_ECCDH_keypair" >Generate Keypair</button>
    <p>Public Key: <span id="A_ECCDH_public_key" class="ciphertext">-</span></p>
    <p>Private Key: <span id="A_ECCDH_private_key" class="ciphertext">-</span></p>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <!-- test web crypto  -->
    <script type="text/javascript" src="js/webcrypto.js"></script>
    <script type="text/javascript" src="js/client_main.js"></script>
    <script type="text/javascript" src="js/attestation_client.js"></script>
    
    <!-- end of web crypto -->
    <script type="text/javascript">
        $('#A_btn_gen_ECCDH_keypair').click(function(event) {
            var crypto = window.crypto || window.msCrypto;
            if (crypto.subtle) {
                promise_key = crypto.subtle.generateKey({name: "ECDH", namedCurve: "P-256",}, true, ["deriveKey", "deriveBits"]);
                promise_key.then(function(key) {
                    A_private_key_object = key.privateKey;
                    A_public_key_object = key.publicKey; 

                    exported_public_key = crypto.subtle.exportKey("jwk", A_public_key_object);//base64url encoding
                    exported_public_key.then(function(key) {
                                //returns the exported key data
                                
                                var plainKey = "<br> x: " + Base64URL2HEX(key.x) +"<br>"+ "y: " + Base64URL2HEX(key.y);
                                A_public_key_x_exported = hexStringToByte(Base64URL2HEX(key.x));
                                A_public_key_y_exported = hexStringToByte(Base64URL2HEX(key.y));

                                $('#A_ECCDH_public_key').html(plainKey);

                                
                            });
                    exported_public_key.catch = function(e) {
                        console.log(e.message);
                    }

                    exported_priv_key = crypto.subtle.exportKey("jwk", A_private_key_object);//base64url encoding
                    exported_priv_key.then(function(key) {
                                //returns the exported key data
                                console.log("private key");

                                // A_private_key_exported = hexStringToByte(Base64URL2HEX(key.d));

                                $('#A_ECCDH_private_key').html(Base64URL2HEX(key.d));
                                
                            });
                    exported_priv_key.catch = function(e) {
                        console.log(e.message);
                    }
                });
                promise_key.catch = function(e) {
                    console.log(e.message);
                }
            } else {
                alert("Cryptography API not Supported");
            }

        });

        //derived shared key using client itself private key (just generated above) and Server's public key g_a
        A_comput_shared_dhkey(A_private_key_object, B_public_key_object);
    </script>
</body>
</html>