<!DOCTYPE html>
<html lang="en">
<head>
	<script type="text/javascript" src="cryptojs-extension-master/lib/cryptojs-aes.min.js"></script>
	<script type="text/javascript" src="cryptojs-extension-master/build/cmac.min.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>

	<!-- test web crypto  -->
	<script type="text/javascript" src="js/webcrypto.js"></script>
	<script type="text/javascript" src="js/client_main.js"></script>
	<script type="text/javascript" src="js/attestation_client.js"></script>
		<!-- test case -->
		<!-- shared key
		32 bytes:
		{
		0x67, 0x3, 0x7f, 0xf5, 0xc4, 0x7c, 0x93, 0xac,
		0xcc, 0xb4, 0xb3, 0xd0, 0xbc, 0xa7, 0x66, 0x2f,
		0x43, 0x6f, 0x3e, 0xf2, 0x39, 0x36, 0x8, 0xb3,
		0xd7, 0xbf, 0x2c, 0x11, 0x41, 0x94, 0xc6, 0x11
		}
		smk_key
		16 bytes:
		{
		0x16, 0xc, 0x1a, 0x7, 0x22, 0x6c, 0xd9, 0xcf,
		0x74, 0x80, 0x43, 0x2a, 0xa1, 0xb0, 0xd7, 0xc
		}
		input: sharedkey = 67037ff5c47c93acccb4b3d0bca7662f436f3ef2393608b3d7bf2c114194c611
		output: smkKey = 160c1a07226cd9cf7480432aa1b0d70c -->
		<!-- test case -->
</head>
<body>
	<script type="text/javascript">
		var sharedkey = "67037ff5c47c93acccb4b3d0bca7662f436f3ef2393608b3d7bf2c114194c611";

		var key = CryptoJS.enc.Hex.parse("00000000000000000000000000000000");
		var message = CryptoJS.enc.Hex.parse("67037ff5c47c93acccb4b3d0bca7662f436f3ef2393608b3d7bf2c114194c611");

		var key_derive_key = CryptoJS.CMAC(key, message);

		console.log("first key");
		console.log(key_derive_key.toString());

		var derived_buffer = new Uint8Array(7);
		derived_buffer.set([1],0);
		var lable = convertStringToArrayBufferView("SMK");
		console.log(lable);
		derived_buffer.set(lable,1);

		var key_length = new Uint16Array(1);
		key_length.set([128],0);
		var key_length_Uint8 = new Uint8Array(key_length.buffer);
		console.log(key_length_Uint8);

		derived_buffer.set(key_length_Uint8,5);
		console.log("derived buffer");
		console.log(byteToHexString(derived_buffer));

		var second_key = CryptoJS.enc.Hex.parse(key_derive_key.toString());
		var second_msg = CryptoJS.enc.Hex.parse(byteToHexString(derived_buffer));

    	var smk = CryptoJS.CMAC(second_key,second_msg);
    	console.log(smk.toString());

    	console.log("it should be 160c1a07226cd9cf7480432aa1b0d70c");

    	console.log("test derive_smk_key function works or not");
    	console.log(derive_smk_key(sharedkey));


    </script>
</body>
</html>